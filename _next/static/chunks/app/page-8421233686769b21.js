(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4135:(e,l,s)=>{Promise.resolve().then(s.bind(s,7837))},7837:(e,l,s)=>{"use strict";s.r(l),s.d(l,{default:()=>eS});var i=s(5155),n=s(2115),t=s(8492),a=s(2531),r=s(317),d=s(6245),c=s(357),o=s(9300),x=s(5416),h=s(670),A=s(7855),j=s(2995),u=s(4966),f=s(3622),m=s(7291),g=s(1123),p=s(8447),v=s(5970),S=s(6120),y=s(223),C=s(4463),b=s(1512),w=s(6388),I=s(4288),E=s(1665),k=s(6170),R=s(2078),G=s(9708);let W=(0,R.Wp)({apiKey:"AIzaSyAffBMfX9NHVgSg_w4a8ZKa55vmp0eHb2w",authDomain:"dd5tools.firebaseapp.com",databaseURL:"https://dd5tools.firebaseio.com",projectId:"dd5tools",storageBucket:"dd5tools.appspot.com",messagingSenderId:"1096592466642",appId:"1:1096592466642:web:f03ea81d304964f1f1030b"}),F=(0,G.aU)(W),z="default_other",N={CATEGORIES:"categories",EFFECTS:"effects",RELICS:"relics",NIGHTRUNNERS:"nightrunners",GRAILS:"grails",FAVORITES:"favorites"},T={getAll:async()=>{let e=(0,G.rJ)(F,N.CATEGORIES),l=(0,G.P)(e,(0,G.My)("name")),s=(await (0,G.GG)(l)).docs.map(e=>({...e.data(),id:e.id}));if(!s.find(e=>e.id===z)){let e={id:z,name:"その他"};await (0,G.BN)((0,G.H9)(F,N.CATEGORIES,z),{name:e.name}),s.unshift(e)}return s},save:async e=>{let l=(0,G.wP)(F);(await (0,G.GG)((0,G.rJ)(F,N.CATEGORIES))).docs.forEach(e=>{l.delete(e.ref)}),e.forEach(e=>{let s=(0,G.H9)(F,N.CATEGORIES,e.id);l.set(s,{name:e.name})}),await l.commit()}},H={getAll:async()=>{let e=(0,G.rJ)(F,N.EFFECTS),l=(await (0,G.GG)(e)).docs.map(e=>({...e.data(),id:e.id}));if(l.some(e=>!e.categoryId)){let e=(0,G.wP)(F);l.forEach(l=>{if(!l.categoryId){l.categoryId=z;let s=(0,G.H9)(F,N.EFFECTS,l.id);e.update(s,{categoryId:z})}}),await e.commit()}return l},save:async e=>{let l=(0,G.wP)(F);(await (0,G.GG)((0,G.rJ)(F,N.EFFECTS))).docs.forEach(e=>{l.delete(e.ref)}),e.forEach(e=>{let s=(0,G.H9)(F,N.EFFECTS,e.id);l.set(s,{categoryId:e.categoryId,description:e.description})}),await l.commit()}},U={getAll:async()=>{let e=(0,G.rJ)(F,N.RELICS);return(await (0,G.GG)(e)).docs.map(e=>({...e.data(),id:e.id}))},save:async e=>{let l=(0,G.wP)(F);(await (0,G.GG)((0,G.rJ)(F,N.RELICS))).docs.forEach(e=>{l.delete(e.ref)}),e.forEach(e=>{let s=(0,G.H9)(F,N.RELICS,e.id);l.set(s,{color:e.color,effects:e.effects})}),await l.commit()}},P={getAll:async()=>{let e=(0,G.rJ)(F,N.NIGHTRUNNERS);return(await (0,G.GG)(e)).docs.map(e=>({...e.data(),id:e.id}))},save:async e=>{let l=(0,G.wP)(F);(await (0,G.GG)((0,G.rJ)(F,N.NIGHTRUNNERS))).docs.forEach(e=>{l.delete(e.ref)}),e.forEach(e=>{let s=(0,G.H9)(F,N.NIGHTRUNNERS,e.id);l.set(s,{name:e.name})}),await l.commit()}},D={getAll:async()=>{let e=(0,G.rJ)(F,N.GRAILS);return(await (0,G.GG)(e)).docs.map(e=>({...e.data(),id:e.id}))},save:async e=>{let l=(0,G.wP)(F);(await (0,G.GG)((0,G.rJ)(F,N.GRAILS))).docs.forEach(e=>{l.delete(e.ref)}),e.forEach(e=>{let s=(0,G.H9)(F,N.GRAILS,e.id);l.set(s,{nightRunnerId:e.nightRunnerId,colors:e.colors})}),await l.commit()}},O={getAll:async()=>{let e=(0,G.rJ)(F,N.FAVORITES),l=(0,G.P)(e,(0,G.My)("createdAt","desc"));return(await (0,G.GG)(l)).docs.map(e=>({...e.data(),id:e.id}))},add:async(e,l)=>{let s="".concat(e,"_").concat(l.join("_")),i=(0,G.H9)(F,N.FAVORITES,s);await (0,G.BN)(i,{grailId:e,relicIds:l,createdAt:Date.now()})},remove:async e=>{let l=(0,G.H9)(F,N.FAVORITES,e);await (0,G.kd)(l)}};var _=s(5265),J=s(2021),L=s(9496),M=s(7515),B=s(4177),V=s(2160),K=s(8963),X=s(6370);function Z(e){let{open:l,effect:s,categories:t,effects:a,onSave:r,onClose:d,defaultCategoryId:o}=e,[x,u]=(0,n.useState)(""),[f,m]=(0,n.useState)(z),[g,p]=(0,n.useState)("");return(0,n.useEffect)(()=>{s?(u(s.description),m(s.categoryId||z)):(u(""),m(o||z)),p("")},[s,o]),(0,i.jsxs)(_.A,{open:l,onClose:d,maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(J.A,{children:s?"効果を編集":"効果を登録"}),(0,i.jsx)(L.A,{children:(0,i.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[g&&(0,i.jsx)(M.A,{severity:"error",children:g}),(0,i.jsxs)(j.A,{fullWidth:!0,children:[(0,i.jsx)(B.A,{children:"カテゴリ"}),(0,i.jsx)(V.A,{value:f,label:"カテゴリ",onChange:e=>m(e.target.value),children:t.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))})]}),(0,i.jsx)(h.A,{autoFocus:!0,label:"効果",fullWidth:!0,value:x,onChange:e=>u(e.target.value)})]})}),(0,i.jsxs)(X.A,{children:[(0,i.jsx)(A.A,{onClick:d,children:"キャンセル"}),(0,i.jsx)(A.A,{onClick:()=>{if(a.find(e=>e.categoryId===f&&e.description===x&&e.id!==(null==s?void 0:s.id)))return void p("同じカテゴリに同じ効果が既に登録されています。");r({id:(null==s?void 0:s.id)||crypto.randomUUID(),categoryId:f,description:x}),u(""),m(z),p("")},variant:"contained",disabled:!x,children:"保存"})]})]})}function q(){let[e,l]=(0,n.useState)([]),[s,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(""),[d,o]=(0,n.useState)(""),[x,R]=(0,n.useState)(null),[G,W]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{let[e,s]=await Promise.all([H.getAll(),T.getAll()]);l(e),t(s)})()},[]);let F=async s=>{let i;l(i=x?e.map(e=>e.id===s.id?s:e):[...e,s]),await H.save(i),W(!1),R(null)},z=async s=>{let i=e.filter(e=>e.id!==s);l(i),await H.save(i)},N=e.filter(e=>{let l=e.description.includes(a),s=!d||e.categoryId===d;return l&&s}).sort((e,l)=>e.description.localeCompare(l.description));return(0,i.jsxs)(c.A,{children:[(0,i.jsxs)(c.A,{sx:{mb:2,display:"flex",flexDirection:"column",gap:2},children:[(0,i.jsxs)(c.A,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,i.jsx)(h.A,{label:"効果で検索",value:a,onChange:e=>r(e.target.value),fullWidth:!0}),(0,i.jsx)(A.A,{variant:"contained",onClick:()=>{R(null),W(!0)},children:"新規登録"})]}),(0,i.jsxs)(j.A,{children:[(0,i.jsx)(u.A,{children:"カテゴリで絞込"}),(0,i.jsxs)(f.A,{row:!0,value:d,onChange:e=>o(e.target.value),children:[(0,i.jsx)(m.A,{value:"",control:(0,i.jsx)(g.A,{}),label:"すべて"}),s.map(e=>(0,i.jsx)(m.A,{value:e.id,control:(0,i.jsx)(g.A,{}),label:e.name},e.id))]})]})]}),(0,i.jsx)(p.A,{component:v.A,children:(0,i.jsxs)(S.A,{children:[(0,i.jsx)(y.A,{children:(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{width:150,children:"カテゴリ"}),(0,i.jsx)(b.A,{children:"効果"}),(0,i.jsx)(b.A,{width:120,children:"操作"})]})}),(0,i.jsx)(w.A,{children:N.map(e=>(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{children:(e=>{let l=s.find(l=>l.id===e);return(null==l?void 0:l.name)||"その他"})(e.categoryId)}),(0,i.jsx)(b.A,{children:e.description}),(0,i.jsxs)(b.A,{children:[(0,i.jsx)(I.A,{onClick:()=>{R(e),W(!0)},size:"small",children:(0,i.jsx)(E.A,{})}),(0,i.jsx)(I.A,{onClick:()=>z(e.id),size:"small",children:(0,i.jsx)(k.A,{})})]})]},e.id))})]})}),(0,i.jsx)(Z,{open:G,effect:x,categories:s,effects:e,onSave:F,onClose:()=>{W(!1),R(null)},defaultCategoryId:d})]})}var Q=s(4193);function Y(e){let{open:l,relic:s,effects:t,categories:a,onSave:d,onClose:o}=e,[x,h]=(0,n.useState)("赤"),[p,v]=(0,n.useState)(""),[S,y]=(0,n.useState)(""),[C,b]=(0,n.useState)(""),[w,I]=(0,n.useState)(""),[E,k]=(0,n.useState)(""),[R,G]=(0,n.useState)("");(0,n.useEffect)(()=>{if(s){h(s.color),v(s.effects[0]),y(s.effects[1]),b(s.effects[2]);let e=t.find(e=>e.id===s.effects[0]),l=t.find(e=>e.id===s.effects[1]),i=t.find(e=>e.id===s.effects[2]);I((null==e?void 0:e.categoryId)||""),k((null==l?void 0:l.categoryId)||""),G((null==i?void 0:i.categoryId)||"")}else h("赤"),v(""),y(""),b(""),I(z),k(z),G(z)},[s,t]);let W=(0,n.useMemo)(()=>w?t.filter(e=>e.categoryId===w):[],[t,w]),F=(0,n.useMemo)(()=>E?t.filter(e=>e.categoryId===E):[],[t,E]),N=(0,n.useMemo)(()=>R?t.filter(e=>e.categoryId===R):[],[t,R]),T=p&&S&&C;return(0,i.jsxs)(_.A,{open:l,onClose:o,maxWidth:"md",fullWidth:!0,children:[(0,i.jsx)(J.A,{children:s?"遺物を編集":"遺物を登録"}),(0,i.jsx)(L.A,{children:(0,i.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[(0,i.jsxs)(j.A,{component:"fieldset",children:[(0,i.jsx)(u.A,{component:"legend",children:"色"}),(0,i.jsxs)(f.A,{row:!0,value:x,onChange:e=>h(e.target.value),children:[(0,i.jsx)(m.A,{value:"赤",control:(0,i.jsx)(g.A,{}),label:"赤"}),(0,i.jsx)(m.A,{value:"青",control:(0,i.jsx)(g.A,{}),label:"青"}),(0,i.jsx)(m.A,{value:"黄",control:(0,i.jsx)(g.A,{}),label:"黄"}),(0,i.jsx)(m.A,{value:"緑",control:(0,i.jsx)(g.A,{}),label:"緑"})]})]}),(0,i.jsx)(r.A,{variant:"subtitle2",sx:{mt:1},children:"効果1"}),(0,i.jsxs)(c.A,{sx:{display:"flex",gap:2},children:[(0,i.jsxs)(j.A,{sx:{width:"20%"},children:[(0,i.jsx)(B.A,{children:"カテゴリ"}),(0,i.jsx)(V.A,{value:w,label:"カテゴリ",onChange:e=>{I(e.target.value),v("")},children:a.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))})]}),(0,i.jsxs)(j.A,{sx:{width:"80%"},disabled:!w,children:[(0,i.jsx)(B.A,{children:"効果"}),(0,i.jsx)(V.A,{value:p,label:"効果",onChange:e=>v(e.target.value),children:W.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.description},e.id))})]})]}),(0,i.jsx)(r.A,{variant:"subtitle2",sx:{mt:1},children:"効果2"}),(0,i.jsxs)(c.A,{sx:{display:"flex",gap:2},children:[(0,i.jsxs)(j.A,{sx:{width:"20%"},children:[(0,i.jsx)(B.A,{children:"カテゴリ"}),(0,i.jsx)(V.A,{value:E,label:"カテゴリ",onChange:e=>{k(e.target.value),y("")},children:a.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))})]}),(0,i.jsxs)(j.A,{sx:{width:"80%"},disabled:!E,children:[(0,i.jsx)(B.A,{children:"効果"}),(0,i.jsx)(V.A,{value:S,label:"効果",onChange:e=>y(e.target.value),children:F.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.description},e.id))})]})]}),(0,i.jsx)(r.A,{variant:"subtitle2",sx:{mt:1},children:"効果3"}),(0,i.jsxs)(c.A,{sx:{display:"flex",gap:2},children:[(0,i.jsxs)(j.A,{sx:{width:"20%"},children:[(0,i.jsx)(B.A,{children:"カテゴリ"}),(0,i.jsx)(V.A,{value:R,label:"カテゴリ",onChange:e=>{G(e.target.value),b("")},children:a.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))})]}),(0,i.jsxs)(j.A,{sx:{width:"80%"},disabled:!R,children:[(0,i.jsx)(B.A,{children:"効果"}),(0,i.jsx)(V.A,{value:C,label:"効果",onChange:e=>b(e.target.value),children:N.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.description},e.id))})]})]})]})}),(0,i.jsxs)(X.A,{children:[(0,i.jsx)(A.A,{onClick:o,children:"キャンセル"}),(0,i.jsx)(A.A,{onClick:()=>{d({id:(null==s?void 0:s.id)||crypto.randomUUID(),color:x,effects:[p,S,C]}),h("赤"),v(""),y(""),b(""),I(z),k(z),G(z)},variant:"contained",disabled:!T,children:"保存"})]})]})}function $(){let[e,l]=(0,n.useState)([]),[s,t]=(0,n.useState)([]),[a,r]=(0,n.useState)([]),[d,o]=(0,n.useState)(""),[x,u]=(0,n.useState)(""),[f,m]=(0,n.useState)(""),[g,R]=(0,n.useState)(null),[G,W]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{let[e,s,i]=await Promise.all([U.getAll(),H.getAll(),T.getAll()]);l(e),t(s),r(i)})()},[]);let F=async s=>{let i;l(i=g?e.map(e=>e.id===s.id?s:e):[...e,s]),await U.save(i),W(!1),R(null)},z=async s=>{let i=e.filter(e=>e.id!==s);l(i),await U.save(i)},N=e=>{let l=s.find(l=>l.id===e);return(null==l?void 0:l.description)||"不明な効果"},P=e.filter(e=>{let l=!x||e.color===x,i=!d||e.effects.some(e=>N(e).includes(d)),n=!f||e.effects.some(e=>{let l=s.find(l=>l.id===e);return(null==l?void 0:l.categoryId)===f});return l&&i&&n});return(0,i.jsxs)(c.A,{children:[(0,i.jsxs)(c.A,{sx:{mb:2,display:"flex",gap:2},children:[(0,i.jsx)(h.A,{label:"効果で検索",value:d,onChange:e=>o(e.target.value),fullWidth:!0}),(0,i.jsxs)(j.A,{sx:{minWidth:150},children:[(0,i.jsx)(B.A,{children:"カテゴリで絞込"}),(0,i.jsxs)(V.A,{value:f,label:"カテゴリで絞込",onChange:e=>m(e.target.value),children:[(0,i.jsx)(K.A,{value:"",children:"すべて"}),a.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))]})]}),(0,i.jsxs)(j.A,{sx:{minWidth:150},children:[(0,i.jsx)(B.A,{children:"色で絞込"}),(0,i.jsxs)(V.A,{value:x,label:"色で絞込",onChange:e=>u(e.target.value),children:[(0,i.jsx)(K.A,{value:"",children:"すべて"}),(0,i.jsx)(K.A,{value:"赤",children:"赤"}),(0,i.jsx)(K.A,{value:"青",children:"青"}),(0,i.jsx)(K.A,{value:"黄",children:"黄"}),(0,i.jsx)(K.A,{value:"緑",children:"緑"})]})]}),(0,i.jsx)(A.A,{variant:"contained",onClick:()=>{R(null),W(!0)},children:"新規登録"})]}),(0,i.jsx)(p.A,{component:v.A,children:(0,i.jsxs)(S.A,{children:[(0,i.jsx)(y.A,{children:(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{width:80,children:"色"}),(0,i.jsx)(b.A,{children:"効果1"}),(0,i.jsx)(b.A,{children:"効果2"}),(0,i.jsx)(b.A,{children:"効果3"}),(0,i.jsx)(b.A,{width:120,children:"操作"})]})}),(0,i.jsx)(w.A,{children:P.map(e=>(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{children:(0,i.jsx)(Q.A,{label:e.color,color:{赤:"error",青:"primary",黄:"warning",緑:"success"}[e.color]})}),(0,i.jsx)(b.A,{children:N(e.effects[0])}),(0,i.jsx)(b.A,{children:N(e.effects[1])}),(0,i.jsx)(b.A,{children:N(e.effects[2])}),(0,i.jsxs)(b.A,{children:[(0,i.jsx)(I.A,{onClick:()=>{R(e),W(!0)},size:"small",children:(0,i.jsx)(E.A,{})}),(0,i.jsx)(I.A,{onClick:()=>z(e.id),size:"small",children:(0,i.jsx)(k.A,{})})]})]},e.id))})]})}),(0,i.jsx)(Y,{open:G,relic:g,effects:s,categories:a,onSave:F,onClose:()=>{W(!1),R(null)}})]})}function ee(e){let{open:l,category:s,onSave:t,onClose:a}=e,[r,d]=(0,n.useState)("");return(0,n.useEffect)(()=>{s?d(s.name):d("")},[s]),(0,i.jsxs)(_.A,{open:l,onClose:a,maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(J.A,{children:s?"カテゴリを編集":"カテゴリを登録"}),(0,i.jsx)(L.A,{children:(0,i.jsx)(h.A,{autoFocus:!0,margin:"dense",label:"カテゴリ名",fullWidth:!0,value:r,onChange:e=>d(e.target.value)})}),(0,i.jsxs)(X.A,{children:[(0,i.jsx)(A.A,{onClick:a,children:"キャンセル"}),(0,i.jsx)(A.A,{onClick:()=>{t({id:(null==s?void 0:s.id)||crypto.randomUUID(),name:r}),d("")},variant:"contained",disabled:!r,children:"保存"})]})]})}function el(){let[e,l]=(0,n.useState)([]),[s,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(null),[d,o]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{let[e,s]=await Promise.all([T.getAll(),H.getAll()]);l(e),t(s)})()},[]);let x=async s=>{let i;l(i=a?e.map(e=>e.id===s.id?s:e):[...e,s]),await T.save(i),o(!1),r(null)},h=async i=>{if(i===z)return void alert("「その他」カテゴリは削除できません。");if(s.some(e=>e.categoryId===i))return void alert("このカテゴリは効果で使用されているため削除できません。");let n=e.filter(e=>e.id!==i);l(n),await T.save(n)};return(0,i.jsxs)(c.A,{children:[(0,i.jsx)(c.A,{sx:{mb:2,display:"flex",gap:2,justifyContent:"flex-end"},children:(0,i.jsx)(A.A,{variant:"contained",onClick:()=>{r(null),o(!0)},children:"新規登録"})}),(0,i.jsx)(p.A,{component:v.A,children:(0,i.jsxs)(S.A,{children:[(0,i.jsx)(y.A,{children:(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{children:"カテゴリ名"}),(0,i.jsx)(b.A,{width:120,children:"操作"})]})}),(0,i.jsx)(w.A,{children:e.map(e=>(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{children:e.name}),(0,i.jsxs)(b.A,{children:[(0,i.jsx)(I.A,{onClick:()=>{r(e),o(!0)},size:"small",children:(0,i.jsx)(E.A,{})}),(0,i.jsx)(I.A,{onClick:()=>h(e.id),size:"small",disabled:e.id===z,children:(0,i.jsx)(k.A,{})})]})]},e.id))})]})}),(0,i.jsx)(ee,{open:d,category:a,onSave:x,onClose:()=>{o(!1),r(null)}})]})}function es(e){let{open:l,nightRunner:s,onSave:t,onClose:a}=e,[r,d]=(0,n.useState)("");return(0,n.useEffect)(()=>{s?d(s.name):d("")},[s]),(0,i.jsxs)(_.A,{open:l,onClose:a,maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(J.A,{children:s?"夜渡りを編集":"夜渡りを登録"}),(0,i.jsx)(L.A,{children:(0,i.jsx)(h.A,{autoFocus:!0,margin:"dense",label:"名前",fullWidth:!0,value:r,onChange:e=>d(e.target.value)})}),(0,i.jsxs)(X.A,{children:[(0,i.jsx)(A.A,{onClick:a,children:"キャンセル"}),(0,i.jsx)(A.A,{onClick:()=>{t({id:(null==s?void 0:s.id)||crypto.randomUUID(),name:r}),d("")},variant:"contained",disabled:!r,children:"保存"})]})]})}function ei(){let[e,l]=(0,n.useState)([]),[s,t]=(0,n.useState)(null),[a,r]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{l(await P.getAll())})()},[]);let d=async i=>{let n;l(n=s?e.map(e=>e.id===i.id?i:e):[...e,i]),await P.save(n),r(!1),t(null)},o=async s=>{let i=e.filter(e=>e.id!==s);l(i),await P.save(i)};return(0,i.jsxs)(c.A,{children:[(0,i.jsx)(c.A,{sx:{mb:2,display:"flex",gap:2,justifyContent:"flex-end"},children:(0,i.jsx)(A.A,{variant:"contained",onClick:()=>{t(null),r(!0)},children:"新規登録"})}),(0,i.jsx)(p.A,{component:v.A,children:(0,i.jsxs)(S.A,{children:[(0,i.jsx)(y.A,{children:(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{children:"名前"}),(0,i.jsx)(b.A,{width:120,children:"操作"})]})}),(0,i.jsx)(w.A,{children:e.map(e=>(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{children:e.name}),(0,i.jsxs)(b.A,{children:[(0,i.jsx)(I.A,{onClick:()=>{t(e),r(!0)},size:"small",children:(0,i.jsx)(E.A,{})}),(0,i.jsx)(I.A,{onClick:()=>o(e.id),size:"small",children:(0,i.jsx)(k.A,{})})]})]},e.id))})]})}),(0,i.jsx)(es,{open:a,nightRunner:s,onSave:d,onClose:()=>{r(!1),t(null)}})]})}let en=["赤","青","黄","緑","無色"];function et(e){let{open:l,grail:s,nightRunners:t,onSave:a,onClose:r}=e,[d,o]=(0,n.useState)(""),[x,h]=(0,n.useState)("赤"),[u,f]=(0,n.useState)("青"),[m,g]=(0,n.useState)("黄");return(0,n.useEffect)(()=>{s?(o(s.nightRunnerId),h(s.colors[0]),f(s.colors[1]),g(s.colors[2])):(o(""),h("赤"),f("青"),g("黄"))},[s]),(0,i.jsxs)(_.A,{open:l,onClose:r,maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(J.A,{children:s?"盃を編集":"盃を登録"}),(0,i.jsx)(L.A,{children:(0,i.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[(0,i.jsxs)(j.A,{fullWidth:!0,children:[(0,i.jsx)(B.A,{children:"夜渡り"}),(0,i.jsx)(V.A,{value:d,label:"夜渡り",onChange:e=>o(e.target.value),children:t.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))})]}),(0,i.jsxs)(j.A,{fullWidth:!0,children:[(0,i.jsx)(B.A,{children:"色1"}),(0,i.jsx)(V.A,{value:x,label:"色1",onChange:e=>h(e.target.value),children:en.map(e=>(0,i.jsx)(K.A,{value:e,children:e},e))})]}),(0,i.jsxs)(j.A,{fullWidth:!0,children:[(0,i.jsx)(B.A,{children:"色2"}),(0,i.jsx)(V.A,{value:u,label:"色2",onChange:e=>f(e.target.value),children:en.map(e=>(0,i.jsx)(K.A,{value:e,children:e},e))})]}),(0,i.jsxs)(j.A,{fullWidth:!0,children:[(0,i.jsx)(B.A,{children:"色3"}),(0,i.jsx)(V.A,{value:m,label:"色3",onChange:e=>g(e.target.value),children:en.map(e=>(0,i.jsx)(K.A,{value:e,children:e},e))})]})]})}),(0,i.jsxs)(X.A,{children:[(0,i.jsx)(A.A,{onClick:r,children:"キャンセル"}),(0,i.jsx)(A.A,{onClick:()=>{a({id:(null==s?void 0:s.id)||crypto.randomUUID(),nightRunnerId:d,colors:[x,u,m]}),o(""),h("赤"),f("青"),g("黄")},variant:"contained",disabled:!d,children:"保存"})]})]})}function ea(){let[e,l]=(0,n.useState)([]),[s,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(""),[d,o]=(0,n.useState)(null),[x,h]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{let[e,s]=await Promise.all([D.getAll(),P.getAll()]);l(e),t(s)})()},[]);let u=async s=>{let i;l(i=d?e.map(e=>e.id===s.id?s:e):[...e,s]),await D.save(i),h(!1),o(null)},f=async s=>{let i=e.filter(e=>e.id!==s);l(i),await D.save(i)},m=e.filter(e=>!a||e.nightRunnerId===a),g=e=>({赤:"error",青:"primary",黄:"warning",緑:"success",無色:"default"})[e];return(0,i.jsxs)(c.A,{children:[(0,i.jsxs)(c.A,{sx:{mb:2,display:"flex",gap:2},children:[(0,i.jsxs)(j.A,{sx:{minWidth:200},children:[(0,i.jsx)(B.A,{children:"夜渡りで絞込"}),(0,i.jsxs)(V.A,{value:a,label:"夜渡りで絞込",onChange:e=>r(e.target.value),children:[(0,i.jsx)(K.A,{value:"",children:"すべて"}),s.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))]})]}),(0,i.jsx)(c.A,{sx:{flex:1}}),(0,i.jsx)(A.A,{variant:"contained",onClick:()=>{o(null),h(!0)},children:"新規登録"})]}),(0,i.jsx)(p.A,{component:v.A,children:(0,i.jsxs)(S.A,{children:[(0,i.jsx)(y.A,{children:(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{children:"夜渡り"}),(0,i.jsx)(b.A,{width:100,children:"色1"}),(0,i.jsx)(b.A,{width:100,children:"色2"}),(0,i.jsx)(b.A,{width:100,children:"色3"}),(0,i.jsx)(b.A,{width:120,children:"操作"})]})}),(0,i.jsx)(w.A,{children:m.map(e=>(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{children:(e=>{let l=s.find(l=>l.id===e);return(null==l?void 0:l.name)||"不明"})(e.nightRunnerId)}),(0,i.jsx)(b.A,{children:(0,i.jsx)(Q.A,{label:e.colors[0],color:g(e.colors[0])})}),(0,i.jsx)(b.A,{children:(0,i.jsx)(Q.A,{label:e.colors[1],color:g(e.colors[1])})}),(0,i.jsx)(b.A,{children:(0,i.jsx)(Q.A,{label:e.colors[2],color:g(e.colors[2])})}),(0,i.jsxs)(b.A,{children:[(0,i.jsx)(I.A,{onClick:()=>{o(e),h(!0)},size:"small",children:(0,i.jsx)(E.A,{})}),(0,i.jsx)(I.A,{onClick:()=>f(e.id),size:"small",children:(0,i.jsx)(k.A,{})})]})]},e.id))})]})}),(0,i.jsx)(et,{open:x,grail:d,nightRunners:s,onSave:u,onClose:()=>{h(!1),o(null)}})]})}var er=s(4962),ed=s(7524),ec=s(4251),eo=s(9518),ex=s(1008),eh=s(3664),eA=s(9131),ej=s(2262),eu=s(9620),ef=s(6021),em=s(9115);function eg(){let[e,l]=(0,n.useState)([]),[s,t]=(0,n.useState)([]),[a,d]=(0,n.useState)([]),[o,x]=(0,n.useState)([]),[h,E]=(0,n.useState)([]),[k,R]=(0,n.useState)([]),[G,W]=(0,n.useState)(""),[F,z]=(0,n.useState)([]),[N,_]=(0,n.useState)([]),[J,L]=(0,n.useState)(!1),[B,V]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>{let[e,s,i,n,a,r]=await Promise.all([P.getAll(),D.getAll(),U.getAll(),H.getAll(),T.getAll(),O.getAll()]);l(e),t(s),d(i),x(n),E(a),R(r)})()},[]);let K=e=>{let l=o.find(l=>l.id===e);return(null==l?void 0:l.description)||"不明"},X=(e,l)=>{let s=[...l].sort();return k.some(l=>l.grailId===e&&[...l.relicIds].sort().join(",")===s.join(","))},Z=async(e,l)=>{let s=l.map(e=>e.id),i="".concat(e.id,"_").concat([...s].sort().join("_"));X(e.id,s)?(await O.remove(i),R(k.filter(e=>e.id!==i)),V("お気に入りから削除しました")):(await O.add(e.id,s),R(await O.getAll()),V("お気に入りに追加しました")),L(!0)};return(0,i.jsxs)(c.A,{children:[(0,i.jsxs)(v.A,{sx:{p:3,mb:3},children:[(0,i.jsx)(r.A,{variant:"h6",sx:{mb:2},children:"複合検索"}),(0,i.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,i.jsxs)(j.A,{children:[(0,i.jsx)(u.A,{children:"夜渡り"}),(0,i.jsx)(f.A,{row:!0,value:G,onChange:e=>W(e.target.value),children:e.map(e=>(0,i.jsx)(m.A,{value:e.id,control:(0,i.jsx)(g.A,{}),label:e.name},e.id))})]}),(0,i.jsxs)(c.A,{sx:{width:"100%"},children:[(0,i.jsxs)(r.A,{variant:"body2",sx:{mb:1,color:"text.secondary"},children:["効果（複数選択可）: ",F.length,"個選択中"]}),h.map(e=>{let l=o.filter(l=>l.categoryId===e.id).sort((e,l)=>e.description.localeCompare(l.description));return 0===l.length?null:(0,i.jsxs)(er.A,{children:[(0,i.jsx)(ed.A,{expandIcon:(0,i.jsx)(eu.A,{}),children:(0,i.jsxs)(r.A,{children:[e.name," (",l.filter(e=>F.includes(e.id)).length,"/",l.length,")"]})}),(0,i.jsx)(ec.A,{children:(0,i.jsx)(eo.A,{sx:{width:"100%",p:0},children:l.map(e=>(0,i.jsxs)(ex.Ay,{sx:{px:0},onClick:()=>{z(F.includes(e.id)?F.filter(l=>l!==e.id):[...F,e.id])},children:[(0,i.jsx)(eh.A,{checked:F.includes(e.id)}),(0,i.jsx)(eA.A,{primary:e.description})]},e.id))})})]},e.id)})]}),(0,i.jsx)(A.A,{variant:"contained",onClick:()=>{if(!G||0===F.length)return void _([]);let l=s.filter(l=>{let s=e.find(e=>e.id===l.nightRunnerId);return l.nightRunnerId===G||(null==s?void 0:s.name)==="全員"}),i=[];for(let e of l){let l=e.colors.map(e=>a.filter(l=>("無色"===e||l.color===e)&&l.effects.some(e=>F.includes(e)))),s=[];for(let n of(!function e(i,n){if(3===i){if(3===new Set(n.map(e=>e.id)).size){let e=new Set;n.forEach(l=>{l.effects.forEach(l=>{F.includes(l)&&e.add(l)})}),e.size===F.length&&s.push([...n])}return}for(let s of l[i])n[i]=s,e(i+1,n)}(0,[]),s))i.push({grail:e,relics:n})}let n=[],t=new Set;for(let e of i){let l=e.relics.map(e=>e.id).sort().join(","),s="".concat(e.grail.id,":").concat(l);t.has(s)||(t.add(s),n.push(e))}_(n)},disabled:!G||0===F.length,children:"検索"})]})]}),N.length>0&&(0,i.jsxs)(c.A,{children:[(0,i.jsxs)(r.A,{variant:"h6",sx:{mb:2},children:["検索結果: ",N.length,"件"]}),N.map((l,s)=>(0,i.jsxs)(v.A,{sx:{p:2,mb:2},children:[(0,i.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,i.jsxs)(r.A,{variant:"subtitle1",children:["盃: ",(l=>{let s=e.find(e=>e.id===l);return(null==s?void 0:s.name)||"不明"})(l.grail.nightRunnerId)," - ",l.grail.colors.map(e=>e).join("・")]}),(0,i.jsx)(I.A,{onClick:()=>Z(l.grail,l.relics),color:"error","aria-label":"お気に入りに追加",children:X(l.grail.id,l.relics.map(e=>e.id))?(0,i.jsx)(ef.A,{}):(0,i.jsx)(em.A,{})})]}),(0,i.jsx)(p.A,{children:(0,i.jsxs)(S.A,{size:"small",children:[(0,i.jsx)(y.A,{children:(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{children:"色"}),(0,i.jsx)(b.A,{children:"効果1"}),(0,i.jsx)(b.A,{children:"効果2"}),(0,i.jsx)(b.A,{children:"効果3"})]})}),(0,i.jsx)(w.A,{children:l.relics.map(e=>(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{children:(0,i.jsx)(Q.A,{label:e.color,color:{赤:"error",青:"primary",黄:"warning",緑:"success",無色:"default"}[e.color],size:"small"})}),(0,i.jsx)(b.A,{children:K(e.effects[0])}),(0,i.jsx)(b.A,{children:K(e.effects[1])}),(0,i.jsx)(b.A,{children:K(e.effects[2])})]},e.id))})]})})]},s))]}),0===N.length&&G&&F.length>0&&(0,i.jsx)(v.A,{sx:{p:3},children:(0,i.jsx)(r.A,{color:"text.secondary",children:"条件に一致する組み合わせが見つかりませんでした。"})}),(0,i.jsx)(ej.A,{open:J,autoHideDuration:3e3,onClose:()=>L(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,i.jsx)(M.A,{onClose:()=>L(!1),severity:"success",sx:{width:"100%"},children:B})})]})}var ep=s(3224);function ev(){let[e,l]=(0,n.useState)([]),[s,t]=(0,n.useState)([]),[a,d]=(0,n.useState)([]),[o,x]=(0,n.useState)([]),[h,j]=(0,n.useState)([]),[u,f]=(0,n.useState)(!1),[m,g]=(0,n.useState)(null);(0,n.useEffect)(()=>{E()},[]);let E=async()=>{let[e,s,i,n,a]=await Promise.all([O.getAll(),D.getAll(),U.getAll(),H.getAll(),P.getAll()]);l(e),t(s),d(i),x(n),j(a)},R=e=>{let l=o.find(l=>l.id===e);return(null==l?void 0:l.description)||"不明"},G=async()=>{m&&(await O.remove(m),await E(),f(!1),g(null))},W=()=>{f(!1),g(null)};return(0,i.jsxs)(c.A,{children:[(0,i.jsxs)(r.A,{variant:"h6",sx:{mb:2},children:["お気に入り: ",e.length,"件"]}),0===e.length&&(0,i.jsx)(v.A,{sx:{p:3},children:(0,i.jsx)(r.A,{color:"text.secondary",children:"お気に入りに登録された組み合わせはありません。"})}),e.map(e=>{let l,n=(l=e.grailId,s.find(e=>e.id===l));if(!n)return null;let t=e.relicIds.map(e=>a.find(l=>l.id===e)).filter(e=>void 0!==e);return 3!==t.length?null:(0,i.jsxs)(v.A,{sx:{p:2,mb:2},children:[(0,i.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,i.jsxs)(r.A,{variant:"subtitle1",children:["盃: ",(e=>{let l=h.find(l=>l.id===e);return(null==l?void 0:l.name)||"不明"})(n.nightRunnerId)," - ",n.colors.map(e=>e).join("・")]}),(0,i.jsx)(I.A,{onClick:()=>{g(e.id),f(!0)},color:"error","aria-label":"お気に入りから削除",children:(0,i.jsx)(k.A,{})})]}),(0,i.jsx)(p.A,{children:(0,i.jsxs)(S.A,{size:"small",children:[(0,i.jsx)(y.A,{children:(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{children:"色"}),(0,i.jsx)(b.A,{children:"効果1"}),(0,i.jsx)(b.A,{children:"効果2"}),(0,i.jsx)(b.A,{children:"効果3"})]})}),(0,i.jsx)(w.A,{children:t.map(e=>(0,i.jsxs)(C.A,{children:[(0,i.jsx)(b.A,{children:(0,i.jsx)(Q.A,{label:e.color,color:{赤:"error",青:"primary",黄:"warning",緑:"success",無色:"default"}[e.color],size:"small"})}),(0,i.jsx)(b.A,{children:R(e.effects[0])}),(0,i.jsx)(b.A,{children:R(e.effects[1])}),(0,i.jsx)(b.A,{children:R(e.effects[2])})]},e.id))})]})})]},e.id)}),(0,i.jsxs)(_.A,{open:u,onClose:W,"aria-labelledby":"delete-dialog-title",children:[(0,i.jsx)(J.A,{id:"delete-dialog-title",children:"お気に入りを削除"}),(0,i.jsx)(L.A,{children:(0,i.jsx)(ep.A,{children:"この組み合わせをお気に入りから削除してもよろしいですか？"})}),(0,i.jsxs)(X.A,{children:[(0,i.jsx)(A.A,{onClick:W,color:"primary",children:"キャンセル"}),(0,i.jsx)(A.A,{onClick:G,color:"error",autoFocus:!0,children:"削除"})]})]})]})}function eS(){let[e,l]=(0,n.useState)(0);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.A,{position:"static",children:(0,i.jsx)(a.A,{children:(0,i.jsx)(r.A,{variant:"h6",component:"div",children:"遺物管理システム"})})}),(0,i.jsxs)(d.A,{maxWidth:"lg",sx:{mt:4},children:[(0,i.jsx)(c.A,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,i.jsxs)(o.A,{value:e,onChange:(e,s)=>l(s),children:[(0,i.jsx)(x.A,{label:"複合検索"}),(0,i.jsx)(x.A,{label:"お気に入り"}),(0,i.jsx)(x.A,{label:"遺物"}),(0,i.jsx)(x.A,{label:"効果"}),(0,i.jsx)(x.A,{label:"カテゴリ"}),(0,i.jsx)(x.A,{label:"夜渡り"}),(0,i.jsx)(x.A,{label:"盃"})]})}),0===e&&(0,i.jsx)(eg,{}),1===e&&(0,i.jsx)(ev,{}),2===e&&(0,i.jsx)($,{}),3===e&&(0,i.jsx)(q,{}),4===e&&(0,i.jsx)(el,{}),5===e&&(0,i.jsx)(ei,{}),6===e&&(0,i.jsx)(ea,{})]})]})}}},e=>{e.O(0,[135,865,428,441,255,358],()=>e(e.s=4135)),_N_E=e.O()}]);