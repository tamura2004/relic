(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2887:(e,l,s)=>{"use strict";s.r(l),s.d(l,{default:()=>eu});var i=s(5155),n=s(2115),t=s(8492),a=s(2531),d=s(317),r=s(6245),c=s(357),o=s(9300),x=s(5416),h=s(670),A=s(7855),j=s(2995),u=s(4966),f=s(3622),m=s(7291),g=s(1123),v=s(8447),p=s(5970),S=s(6120),C=s(223),y=s(4463),b=s(1512),w=s(6388),I=s(4288),E=s(1665),k=s(6170),G=s(2078),R=s(9708);let W=(0,G.Wp)({apiKey:"AIzaSyAffBMfX9NHVgSg_w4a8ZKa55vmp0eHb2w",authDomain:"dd5tools.firebaseapp.com",databaseURL:"https://dd5tools.firebaseio.com",projectId:"dd5tools",storageBucket:"dd5tools.appspot.com",messagingSenderId:"1096592466642",appId:"1:1096592466642:web:f03ea81d304964f1f1030b"}),N=(0,R.aU)(W),U="default_other",z={CATEGORIES:"categories",EFFECTS:"effects",RELICS:"relics",NIGHTRUNNERS:"nightrunners",GRAILS:"grails"},F={getAll:async()=>{let e=(0,R.rJ)(N,z.CATEGORIES),l=(0,R.P)(e,(0,R.My)("name")),s=(await (0,R.GG)(l)).docs.map(e=>({...e.data(),id:e.id}));if(!s.find(e=>e.id===U)){let e={id:U,name:"その他"};await (0,R.BN)((0,R.H9)(N,z.CATEGORIES,U),{name:e.name}),s.unshift(e)}return s},save:async e=>{let l=(0,R.wP)(N);(await (0,R.GG)((0,R.rJ)(N,z.CATEGORIES))).docs.forEach(e=>{l.delete(e.ref)}),e.forEach(e=>{let s=(0,R.H9)(N,z.CATEGORIES,e.id);l.set(s,{name:e.name})}),await l.commit()}},T={getAll:async()=>{let e=(0,R.rJ)(N,z.EFFECTS),l=(await (0,R.GG)(e)).docs.map(e=>({...e.data(),id:e.id}));if(l.some(e=>!e.categoryId)){let e=(0,R.wP)(N);l.forEach(l=>{if(!l.categoryId){l.categoryId=U;let s=(0,R.H9)(N,z.EFFECTS,l.id);e.update(s,{categoryId:U})}}),await e.commit()}return l},save:async e=>{let l=(0,R.wP)(N);(await (0,R.GG)((0,R.rJ)(N,z.EFFECTS))).docs.forEach(e=>{l.delete(e.ref)}),e.forEach(e=>{let s=(0,R.H9)(N,z.EFFECTS,e.id);l.set(s,{categoryId:e.categoryId,description:e.description})}),await l.commit()}},H={getAll:async()=>{let e=(0,R.rJ)(N,z.RELICS);return(await (0,R.GG)(e)).docs.map(e=>({...e.data(),id:e.id}))},save:async e=>{let l=(0,R.wP)(N);(await (0,R.GG)((0,R.rJ)(N,z.RELICS))).docs.forEach(e=>{l.delete(e.ref)}),e.forEach(e=>{let s=(0,R.H9)(N,z.RELICS,e.id);l.set(s,{color:e.color,effects:e.effects})}),await l.commit()}},P={getAll:async()=>{let e=(0,R.rJ)(N,z.NIGHTRUNNERS);return(await (0,R.GG)(e)).docs.map(e=>({...e.data(),id:e.id}))},save:async e=>{let l=(0,R.wP)(N);(await (0,R.GG)((0,R.rJ)(N,z.NIGHTRUNNERS))).docs.forEach(e=>{l.delete(e.ref)}),e.forEach(e=>{let s=(0,R.H9)(N,z.NIGHTRUNNERS,e.id);l.set(s,{name:e.name})}),await l.commit()}},D={getAll:async()=>{let e=(0,R.rJ)(N,z.GRAILS);return(await (0,R.GG)(e)).docs.map(e=>({...e.data(),id:e.id}))},save:async e=>{let l=(0,R.wP)(N);(await (0,R.GG)((0,R.rJ)(N,z.GRAILS))).docs.forEach(e=>{l.delete(e.ref)}),e.forEach(e=>{let s=(0,R.H9)(N,z.GRAILS,e.id);l.set(s,{nightRunnerId:e.nightRunnerId,colors:e.colors})}),await l.commit()}};var J=s(5265),L=s(2021),_=s(9496),O=s(7515),M=s(4177),B=s(2111),K=s(8963),V=s(6370);function X(e){let{open:l,effect:s,categories:t,effects:a,onSave:d,onClose:r,defaultCategoryId:o}=e,[x,u]=(0,n.useState)(""),[f,m]=(0,n.useState)(U),[g,v]=(0,n.useState)("");return(0,n.useEffect)(()=>{s?(u(s.description),m(s.categoryId||U)):(u(""),m(o||U)),v("")},[s,o]),(0,i.jsxs)(J.A,{open:l,onClose:r,maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(L.A,{children:s?"効果を編集":"効果を登録"}),(0,i.jsx)(_.A,{children:(0,i.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[g&&(0,i.jsx)(O.A,{severity:"error",children:g}),(0,i.jsxs)(j.A,{fullWidth:!0,children:[(0,i.jsx)(M.A,{children:"カテゴリ"}),(0,i.jsx)(B.A,{value:f,label:"カテゴリ",onChange:e=>m(e.target.value),children:t.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))})]}),(0,i.jsx)(h.A,{autoFocus:!0,label:"効果",fullWidth:!0,value:x,onChange:e=>u(e.target.value)})]})}),(0,i.jsxs)(V.A,{children:[(0,i.jsx)(A.A,{onClick:r,children:"キャンセル"}),(0,i.jsx)(A.A,{onClick:()=>{if(a.find(e=>e.categoryId===f&&e.description===x&&e.id!==(null==s?void 0:s.id)))return void v("同じカテゴリに同じ効果が既に登録されています。");d({id:(null==s?void 0:s.id)||crypto.randomUUID(),categoryId:f,description:x}),u(""),m(U),v("")},variant:"contained",disabled:!x,children:"保存"})]})]})}function Z(){let[e,l]=(0,n.useState)([]),[s,t]=(0,n.useState)([]),[a,d]=(0,n.useState)(""),[r,o]=(0,n.useState)(""),[x,G]=(0,n.useState)(null),[R,W]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{let[e,s]=await Promise.all([T.getAll(),F.getAll()]);l(e),t(s)})()},[]);let N=async s=>{let i;l(i=x?e.map(e=>e.id===s.id?s:e):[...e,s]),await T.save(i),W(!1),G(null)},U=async s=>{let i=e.filter(e=>e.id!==s);l(i),await T.save(i)},z=e.filter(e=>{let l=e.description.includes(a),s=!r||e.categoryId===r;return l&&s}).sort((e,l)=>e.description.localeCompare(l.description));return(0,i.jsxs)(c.A,{children:[(0,i.jsxs)(c.A,{sx:{mb:2,display:"flex",flexDirection:"column",gap:2},children:[(0,i.jsxs)(c.A,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,i.jsx)(h.A,{label:"効果で検索",value:a,onChange:e=>d(e.target.value),fullWidth:!0}),(0,i.jsx)(A.A,{variant:"contained",onClick:()=>{G(null),W(!0)},children:"新規登録"})]}),(0,i.jsxs)(j.A,{children:[(0,i.jsx)(u.A,{children:"カテゴリで絞込"}),(0,i.jsxs)(f.A,{row:!0,value:r,onChange:e=>o(e.target.value),children:[(0,i.jsx)(m.A,{value:"",control:(0,i.jsx)(g.A,{}),label:"すべて"}),s.map(e=>(0,i.jsx)(m.A,{value:e.id,control:(0,i.jsx)(g.A,{}),label:e.name},e.id))]})]})]}),(0,i.jsx)(v.A,{component:p.A,children:(0,i.jsxs)(S.A,{children:[(0,i.jsx)(C.A,{children:(0,i.jsxs)(y.A,{children:[(0,i.jsx)(b.A,{width:150,children:"カテゴリ"}),(0,i.jsx)(b.A,{children:"効果"}),(0,i.jsx)(b.A,{width:120,children:"操作"})]})}),(0,i.jsx)(w.A,{children:z.map(e=>(0,i.jsxs)(y.A,{children:[(0,i.jsx)(b.A,{children:(e=>{let l=s.find(l=>l.id===e);return(null==l?void 0:l.name)||"その他"})(e.categoryId)}),(0,i.jsx)(b.A,{children:e.description}),(0,i.jsxs)(b.A,{children:[(0,i.jsx)(I.A,{onClick:()=>{G(e),W(!0)},size:"small",children:(0,i.jsx)(E.A,{})}),(0,i.jsx)(I.A,{onClick:()=>U(e.id),size:"small",children:(0,i.jsx)(k.A,{})})]})]},e.id))})]})}),(0,i.jsx)(X,{open:R,effect:x,categories:s,effects:e,onSave:N,onClose:()=>{W(!1),G(null)},defaultCategoryId:r})]})}var q=s(4193);function Q(e){let{open:l,relic:s,effects:t,categories:a,onSave:r,onClose:o}=e,[x,h]=(0,n.useState)("赤"),[v,p]=(0,n.useState)(""),[S,C]=(0,n.useState)(""),[y,b]=(0,n.useState)(""),[w,I]=(0,n.useState)(""),[E,k]=(0,n.useState)(""),[G,R]=(0,n.useState)("");(0,n.useEffect)(()=>{if(s){h(s.color),p(s.effects[0]),C(s.effects[1]),b(s.effects[2]);let e=t.find(e=>e.id===s.effects[0]),l=t.find(e=>e.id===s.effects[1]),i=t.find(e=>e.id===s.effects[2]);I((null==e?void 0:e.categoryId)||""),k((null==l?void 0:l.categoryId)||""),R((null==i?void 0:i.categoryId)||"")}else h("赤"),p(""),C(""),b(""),I(U),k(U),R(U)},[s,t]);let W=(0,n.useMemo)(()=>w?t.filter(e=>e.categoryId===w):[],[t,w]),N=(0,n.useMemo)(()=>E?t.filter(e=>e.categoryId===E):[],[t,E]),z=(0,n.useMemo)(()=>G?t.filter(e=>e.categoryId===G):[],[t,G]),F=v&&S&&y;return(0,i.jsxs)(J.A,{open:l,onClose:o,maxWidth:"md",fullWidth:!0,children:[(0,i.jsx)(L.A,{children:s?"遺物を編集":"遺物を登録"}),(0,i.jsx)(_.A,{children:(0,i.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[(0,i.jsxs)(j.A,{component:"fieldset",children:[(0,i.jsx)(u.A,{component:"legend",children:"色"}),(0,i.jsxs)(f.A,{row:!0,value:x,onChange:e=>h(e.target.value),children:[(0,i.jsx)(m.A,{value:"赤",control:(0,i.jsx)(g.A,{}),label:"赤"}),(0,i.jsx)(m.A,{value:"青",control:(0,i.jsx)(g.A,{}),label:"青"}),(0,i.jsx)(m.A,{value:"黄",control:(0,i.jsx)(g.A,{}),label:"黄"}),(0,i.jsx)(m.A,{value:"緑",control:(0,i.jsx)(g.A,{}),label:"緑"})]})]}),(0,i.jsx)(d.A,{variant:"subtitle2",sx:{mt:1},children:"効果1"}),(0,i.jsxs)(c.A,{sx:{display:"flex",gap:2},children:[(0,i.jsxs)(j.A,{sx:{width:"20%"},children:[(0,i.jsx)(M.A,{children:"カテゴリ"}),(0,i.jsx)(B.A,{value:w,label:"カテゴリ",onChange:e=>{I(e.target.value),p("")},children:a.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))})]}),(0,i.jsxs)(j.A,{sx:{width:"80%"},disabled:!w,children:[(0,i.jsx)(M.A,{children:"効果"}),(0,i.jsx)(B.A,{value:v,label:"効果",onChange:e=>p(e.target.value),children:W.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.description},e.id))})]})]}),(0,i.jsx)(d.A,{variant:"subtitle2",sx:{mt:1},children:"効果2"}),(0,i.jsxs)(c.A,{sx:{display:"flex",gap:2},children:[(0,i.jsxs)(j.A,{sx:{width:"20%"},children:[(0,i.jsx)(M.A,{children:"カテゴリ"}),(0,i.jsx)(B.A,{value:E,label:"カテゴリ",onChange:e=>{k(e.target.value),C("")},children:a.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))})]}),(0,i.jsxs)(j.A,{sx:{width:"80%"},disabled:!E,children:[(0,i.jsx)(M.A,{children:"効果"}),(0,i.jsx)(B.A,{value:S,label:"効果",onChange:e=>C(e.target.value),children:N.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.description},e.id))})]})]}),(0,i.jsx)(d.A,{variant:"subtitle2",sx:{mt:1},children:"効果3"}),(0,i.jsxs)(c.A,{sx:{display:"flex",gap:2},children:[(0,i.jsxs)(j.A,{sx:{width:"20%"},children:[(0,i.jsx)(M.A,{children:"カテゴリ"}),(0,i.jsx)(B.A,{value:G,label:"カテゴリ",onChange:e=>{R(e.target.value),b("")},children:a.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))})]}),(0,i.jsxs)(j.A,{sx:{width:"80%"},disabled:!G,children:[(0,i.jsx)(M.A,{children:"効果"}),(0,i.jsx)(B.A,{value:y,label:"効果",onChange:e=>b(e.target.value),children:z.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.description},e.id))})]})]})]})}),(0,i.jsxs)(V.A,{children:[(0,i.jsx)(A.A,{onClick:o,children:"キャンセル"}),(0,i.jsx)(A.A,{onClick:()=>{r({id:(null==s?void 0:s.id)||crypto.randomUUID(),color:x,effects:[v,S,y]}),h("赤"),p(""),C(""),b(""),I(U),k(U),R(U)},variant:"contained",disabled:!F,children:"保存"})]})]})}function Y(){let[e,l]=(0,n.useState)([]),[s,t]=(0,n.useState)([]),[a,d]=(0,n.useState)([]),[r,o]=(0,n.useState)(""),[x,u]=(0,n.useState)(""),[f,m]=(0,n.useState)(""),[g,G]=(0,n.useState)(null),[R,W]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{let[e,s,i]=await Promise.all([H.getAll(),T.getAll(),F.getAll()]);l(e),t(s),d(i)})()},[]);let N=async s=>{let i;l(i=g?e.map(e=>e.id===s.id?s:e):[...e,s]),await H.save(i),W(!1),G(null)},U=async s=>{let i=e.filter(e=>e.id!==s);l(i),await H.save(i)},z=e=>{let l=s.find(l=>l.id===e);return(null==l?void 0:l.description)||"不明な効果"},P=e.filter(e=>{let l=!x||e.color===x,i=!r||e.effects.some(e=>z(e).includes(r)),n=!f||e.effects.some(e=>{let l=s.find(l=>l.id===e);return(null==l?void 0:l.categoryId)===f});return l&&i&&n});return(0,i.jsxs)(c.A,{children:[(0,i.jsxs)(c.A,{sx:{mb:2,display:"flex",gap:2},children:[(0,i.jsx)(h.A,{label:"効果で検索",value:r,onChange:e=>o(e.target.value),fullWidth:!0}),(0,i.jsxs)(j.A,{sx:{minWidth:150},children:[(0,i.jsx)(M.A,{children:"カテゴリで絞込"}),(0,i.jsxs)(B.A,{value:f,label:"カテゴリで絞込",onChange:e=>m(e.target.value),children:[(0,i.jsx)(K.A,{value:"",children:"すべて"}),a.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))]})]}),(0,i.jsxs)(j.A,{sx:{minWidth:150},children:[(0,i.jsx)(M.A,{children:"色で絞込"}),(0,i.jsxs)(B.A,{value:x,label:"色で絞込",onChange:e=>u(e.target.value),children:[(0,i.jsx)(K.A,{value:"",children:"すべて"}),(0,i.jsx)(K.A,{value:"赤",children:"赤"}),(0,i.jsx)(K.A,{value:"青",children:"青"}),(0,i.jsx)(K.A,{value:"黄",children:"黄"}),(0,i.jsx)(K.A,{value:"緑",children:"緑"})]})]}),(0,i.jsx)(A.A,{variant:"contained",onClick:()=>{G(null),W(!0)},children:"新規登録"})]}),(0,i.jsx)(v.A,{component:p.A,children:(0,i.jsxs)(S.A,{children:[(0,i.jsx)(C.A,{children:(0,i.jsxs)(y.A,{children:[(0,i.jsx)(b.A,{width:80,children:"色"}),(0,i.jsx)(b.A,{children:"効果1"}),(0,i.jsx)(b.A,{children:"効果2"}),(0,i.jsx)(b.A,{children:"効果3"}),(0,i.jsx)(b.A,{width:120,children:"操作"})]})}),(0,i.jsx)(w.A,{children:P.map(e=>(0,i.jsxs)(y.A,{children:[(0,i.jsx)(b.A,{children:(0,i.jsx)(q.A,{label:e.color,color:{赤:"error",青:"primary",黄:"warning",緑:"success"}[e.color]})}),(0,i.jsx)(b.A,{children:z(e.effects[0])}),(0,i.jsx)(b.A,{children:z(e.effects[1])}),(0,i.jsx)(b.A,{children:z(e.effects[2])}),(0,i.jsxs)(b.A,{children:[(0,i.jsx)(I.A,{onClick:()=>{G(e),W(!0)},size:"small",children:(0,i.jsx)(E.A,{})}),(0,i.jsx)(I.A,{onClick:()=>U(e.id),size:"small",children:(0,i.jsx)(k.A,{})})]})]},e.id))})]})}),(0,i.jsx)(Q,{open:R,relic:g,effects:s,categories:a,onSave:N,onClose:()=>{W(!1),G(null)}})]})}function $(e){let{open:l,category:s,onSave:t,onClose:a}=e,[d,r]=(0,n.useState)("");return(0,n.useEffect)(()=>{s?r(s.name):r("")},[s]),(0,i.jsxs)(J.A,{open:l,onClose:a,maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(L.A,{children:s?"カテゴリを編集":"カテゴリを登録"}),(0,i.jsx)(_.A,{children:(0,i.jsx)(h.A,{autoFocus:!0,margin:"dense",label:"カテゴリ名",fullWidth:!0,value:d,onChange:e=>r(e.target.value)})}),(0,i.jsxs)(V.A,{children:[(0,i.jsx)(A.A,{onClick:a,children:"キャンセル"}),(0,i.jsx)(A.A,{onClick:()=>{t({id:(null==s?void 0:s.id)||crypto.randomUUID(),name:d}),r("")},variant:"contained",disabled:!d,children:"保存"})]})]})}function ee(){let[e,l]=(0,n.useState)([]),[s,t]=(0,n.useState)([]),[a,d]=(0,n.useState)(null),[r,o]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{let[e,s]=await Promise.all([F.getAll(),T.getAll()]);l(e),t(s)})()},[]);let x=async s=>{let i;l(i=a?e.map(e=>e.id===s.id?s:e):[...e,s]),await F.save(i),o(!1),d(null)},h=async i=>{if(i===U)return void alert("「その他」カテゴリは削除できません。");if(s.some(e=>e.categoryId===i))return void alert("このカテゴリは効果で使用されているため削除できません。");let n=e.filter(e=>e.id!==i);l(n),await F.save(n)};return(0,i.jsxs)(c.A,{children:[(0,i.jsx)(c.A,{sx:{mb:2,display:"flex",gap:2,justifyContent:"flex-end"},children:(0,i.jsx)(A.A,{variant:"contained",onClick:()=>{d(null),o(!0)},children:"新規登録"})}),(0,i.jsx)(v.A,{component:p.A,children:(0,i.jsxs)(S.A,{children:[(0,i.jsx)(C.A,{children:(0,i.jsxs)(y.A,{children:[(0,i.jsx)(b.A,{children:"カテゴリ名"}),(0,i.jsx)(b.A,{width:120,children:"操作"})]})}),(0,i.jsx)(w.A,{children:e.map(e=>(0,i.jsxs)(y.A,{children:[(0,i.jsx)(b.A,{children:e.name}),(0,i.jsxs)(b.A,{children:[(0,i.jsx)(I.A,{onClick:()=>{d(e),o(!0)},size:"small",children:(0,i.jsx)(E.A,{})}),(0,i.jsx)(I.A,{onClick:()=>h(e.id),size:"small",disabled:e.id===U,children:(0,i.jsx)(k.A,{})})]})]},e.id))})]})}),(0,i.jsx)($,{open:r,category:a,onSave:x,onClose:()=>{o(!1),d(null)}})]})}function el(e){let{open:l,nightRunner:s,onSave:t,onClose:a}=e,[d,r]=(0,n.useState)("");return(0,n.useEffect)(()=>{s?r(s.name):r("")},[s]),(0,i.jsxs)(J.A,{open:l,onClose:a,maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(L.A,{children:s?"夜渡りを編集":"夜渡りを登録"}),(0,i.jsx)(_.A,{children:(0,i.jsx)(h.A,{autoFocus:!0,margin:"dense",label:"名前",fullWidth:!0,value:d,onChange:e=>r(e.target.value)})}),(0,i.jsxs)(V.A,{children:[(0,i.jsx)(A.A,{onClick:a,children:"キャンセル"}),(0,i.jsx)(A.A,{onClick:()=>{t({id:(null==s?void 0:s.id)||crypto.randomUUID(),name:d}),r("")},variant:"contained",disabled:!d,children:"保存"})]})]})}function es(){let[e,l]=(0,n.useState)([]),[s,t]=(0,n.useState)(null),[a,d]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{l(await P.getAll())})()},[]);let r=async i=>{let n;l(n=s?e.map(e=>e.id===i.id?i:e):[...e,i]),await P.save(n),d(!1),t(null)},o=async s=>{let i=e.filter(e=>e.id!==s);l(i),await P.save(i)};return(0,i.jsxs)(c.A,{children:[(0,i.jsx)(c.A,{sx:{mb:2,display:"flex",gap:2,justifyContent:"flex-end"},children:(0,i.jsx)(A.A,{variant:"contained",onClick:()=>{t(null),d(!0)},children:"新規登録"})}),(0,i.jsx)(v.A,{component:p.A,children:(0,i.jsxs)(S.A,{children:[(0,i.jsx)(C.A,{children:(0,i.jsxs)(y.A,{children:[(0,i.jsx)(b.A,{children:"名前"}),(0,i.jsx)(b.A,{width:120,children:"操作"})]})}),(0,i.jsx)(w.A,{children:e.map(e=>(0,i.jsxs)(y.A,{children:[(0,i.jsx)(b.A,{children:e.name}),(0,i.jsxs)(b.A,{children:[(0,i.jsx)(I.A,{onClick:()=>{t(e),d(!0)},size:"small",children:(0,i.jsx)(E.A,{})}),(0,i.jsx)(I.A,{onClick:()=>o(e.id),size:"small",children:(0,i.jsx)(k.A,{})})]})]},e.id))})]})}),(0,i.jsx)(el,{open:a,nightRunner:s,onSave:r,onClose:()=>{d(!1),t(null)}})]})}let ei=["赤","青","黄","緑","無色"];function en(e){let{open:l,grail:s,nightRunners:t,onSave:a,onClose:d}=e,[r,o]=(0,n.useState)(""),[x,h]=(0,n.useState)("赤"),[u,f]=(0,n.useState)("青"),[m,g]=(0,n.useState)("黄");return(0,n.useEffect)(()=>{s?(o(s.nightRunnerId),h(s.colors[0]),f(s.colors[1]),g(s.colors[2])):(o(""),h("赤"),f("青"),g("黄"))},[s]),(0,i.jsxs)(J.A,{open:l,onClose:d,maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(L.A,{children:s?"盃を編集":"盃を登録"}),(0,i.jsx)(_.A,{children:(0,i.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[(0,i.jsxs)(j.A,{fullWidth:!0,children:[(0,i.jsx)(M.A,{children:"夜渡り"}),(0,i.jsx)(B.A,{value:r,label:"夜渡り",onChange:e=>o(e.target.value),children:t.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))})]}),(0,i.jsxs)(j.A,{fullWidth:!0,children:[(0,i.jsx)(M.A,{children:"色1"}),(0,i.jsx)(B.A,{value:x,label:"色1",onChange:e=>h(e.target.value),children:ei.map(e=>(0,i.jsx)(K.A,{value:e,children:e},e))})]}),(0,i.jsxs)(j.A,{fullWidth:!0,children:[(0,i.jsx)(M.A,{children:"色2"}),(0,i.jsx)(B.A,{value:u,label:"色2",onChange:e=>f(e.target.value),children:ei.map(e=>(0,i.jsx)(K.A,{value:e,children:e},e))})]}),(0,i.jsxs)(j.A,{fullWidth:!0,children:[(0,i.jsx)(M.A,{children:"色3"}),(0,i.jsx)(B.A,{value:m,label:"色3",onChange:e=>g(e.target.value),children:ei.map(e=>(0,i.jsx)(K.A,{value:e,children:e},e))})]})]})}),(0,i.jsxs)(V.A,{children:[(0,i.jsx)(A.A,{onClick:d,children:"キャンセル"}),(0,i.jsx)(A.A,{onClick:()=>{a({id:(null==s?void 0:s.id)||crypto.randomUUID(),nightRunnerId:r,colors:[x,u,m]}),o(""),h("赤"),f("青"),g("黄")},variant:"contained",disabled:!r,children:"保存"})]})]})}function et(){let[e,l]=(0,n.useState)([]),[s,t]=(0,n.useState)([]),[a,d]=(0,n.useState)(""),[r,o]=(0,n.useState)(null),[x,h]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{let[e,s]=await Promise.all([D.getAll(),P.getAll()]);l(e),t(s)})()},[]);let u=async s=>{let i;l(i=r?e.map(e=>e.id===s.id?s:e):[...e,s]),await D.save(i),h(!1),o(null)},f=async s=>{let i=e.filter(e=>e.id!==s);l(i),await D.save(i)},m=e.filter(e=>!a||e.nightRunnerId===a),g=e=>({赤:"error",青:"primary",黄:"warning",緑:"success",無色:"default"})[e];return(0,i.jsxs)(c.A,{children:[(0,i.jsxs)(c.A,{sx:{mb:2,display:"flex",gap:2},children:[(0,i.jsxs)(j.A,{sx:{minWidth:200},children:[(0,i.jsx)(M.A,{children:"夜渡りで絞込"}),(0,i.jsxs)(B.A,{value:a,label:"夜渡りで絞込",onChange:e=>d(e.target.value),children:[(0,i.jsx)(K.A,{value:"",children:"すべて"}),s.map(e=>(0,i.jsx)(K.A,{value:e.id,children:e.name},e.id))]})]}),(0,i.jsx)(c.A,{sx:{flex:1}}),(0,i.jsx)(A.A,{variant:"contained",onClick:()=>{o(null),h(!0)},children:"新規登録"})]}),(0,i.jsx)(v.A,{component:p.A,children:(0,i.jsxs)(S.A,{children:[(0,i.jsx)(C.A,{children:(0,i.jsxs)(y.A,{children:[(0,i.jsx)(b.A,{children:"夜渡り"}),(0,i.jsx)(b.A,{width:100,children:"色1"}),(0,i.jsx)(b.A,{width:100,children:"色2"}),(0,i.jsx)(b.A,{width:100,children:"色3"}),(0,i.jsx)(b.A,{width:120,children:"操作"})]})}),(0,i.jsx)(w.A,{children:m.map(e=>(0,i.jsxs)(y.A,{children:[(0,i.jsx)(b.A,{children:(e=>{let l=s.find(l=>l.id===e);return(null==l?void 0:l.name)||"不明"})(e.nightRunnerId)}),(0,i.jsx)(b.A,{children:(0,i.jsx)(q.A,{label:e.colors[0],color:g(e.colors[0])})}),(0,i.jsx)(b.A,{children:(0,i.jsx)(q.A,{label:e.colors[1],color:g(e.colors[1])})}),(0,i.jsx)(b.A,{children:(0,i.jsx)(q.A,{label:e.colors[2],color:g(e.colors[2])})}),(0,i.jsxs)(b.A,{children:[(0,i.jsx)(I.A,{onClick:()=>{o(e),h(!0)},size:"small",children:(0,i.jsx)(E.A,{})}),(0,i.jsx)(I.A,{onClick:()=>f(e.id),size:"small",children:(0,i.jsx)(k.A,{})})]})]},e.id))})]})}),(0,i.jsx)(en,{open:x,grail:r,nightRunners:s,onSave:u,onClose:()=>{h(!1),o(null)}})]})}var ea=s(4962),ed=s(7524),er=s(4251),ec=s(9518),eo=s(1008),ex=s(3664),eh=s(9131),eA=s(9620);function ej(){let[e,l]=(0,n.useState)([]),[s,t]=(0,n.useState)([]),[a,r]=(0,n.useState)([]),[o,x]=(0,n.useState)([]),[h,I]=(0,n.useState)([]),[E,k]=(0,n.useState)(""),[G,R]=(0,n.useState)([]),[W,N]=(0,n.useState)([]);(0,n.useEffect)(()=>{(async()=>{let[e,s,i,n,a]=await Promise.all([P.getAll(),D.getAll(),H.getAll(),T.getAll(),F.getAll()]);l(e),t(s),r(i),x(n),I(a)})()},[]);let U=e=>{let l=o.find(l=>l.id===e);return(null==l?void 0:l.description)||"不明"};return(0,i.jsxs)(c.A,{children:[(0,i.jsxs)(p.A,{sx:{p:3,mb:3},children:[(0,i.jsx)(d.A,{variant:"h6",sx:{mb:2},children:"複合検索"}),(0,i.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,i.jsxs)(j.A,{children:[(0,i.jsx)(u.A,{children:"夜渡り"}),(0,i.jsx)(f.A,{row:!0,value:E,onChange:e=>k(e.target.value),children:e.map(e=>(0,i.jsx)(m.A,{value:e.id,control:(0,i.jsx)(g.A,{}),label:e.name},e.id))})]}),(0,i.jsxs)(c.A,{sx:{width:"100%"},children:[(0,i.jsxs)(d.A,{variant:"body2",sx:{mb:1,color:"text.secondary"},children:["効果（複数選択可）: ",G.length,"個選択中"]}),h.map(e=>{let l=o.filter(l=>l.categoryId===e.id).sort((e,l)=>e.description.localeCompare(l.description));return 0===l.length?null:(0,i.jsxs)(ea.A,{children:[(0,i.jsx)(ed.A,{expandIcon:(0,i.jsx)(eA.A,{}),children:(0,i.jsxs)(d.A,{children:[e.name," (",l.filter(e=>G.includes(e.id)).length,"/",l.length,")"]})}),(0,i.jsx)(er.A,{children:(0,i.jsx)(ec.A,{sx:{width:"100%",p:0},children:l.map(e=>(0,i.jsxs)(eo.Ay,{sx:{px:0},onClick:()=>{R(G.includes(e.id)?G.filter(l=>l!==e.id):[...G,e.id])},children:[(0,i.jsx)(ex.A,{checked:G.includes(e.id)}),(0,i.jsx)(eh.A,{primary:e.description})]},e.id))})})]},e.id)})]}),(0,i.jsx)(A.A,{variant:"contained",onClick:()=>{if(!E||0===G.length)return void N([]);let l=s.filter(l=>{let s=e.find(e=>e.id===l.nightRunnerId);return l.nightRunnerId===E||(null==s?void 0:s.name)==="全員"}),i=[];for(let e of l){let l=e.colors.map(e=>a.filter(l=>("無色"===e||l.color===e)&&l.effects.some(e=>G.includes(e)))),s=[];for(let n of(!function e(i,n){if(3===i){if(3===new Set(n.map(e=>e.id)).size){let e=new Set;n.forEach(l=>{l.effects.forEach(l=>{G.includes(l)&&e.add(l)})}),e.size===G.length&&s.push([...n])}return}for(let s of l[i])n[i]=s,e(i+1,n)}(0,[]),s))i.push({grail:e,relics:n})}let n=[],t=new Set;for(let e of i){let l=e.relics.map(e=>e.id).sort().join(","),s="".concat(e.grail.id,":").concat(l);t.has(s)||(t.add(s),n.push(e))}N(n)},disabled:!E||0===G.length,children:"検索"})]})]}),W.length>0&&(0,i.jsxs)(c.A,{children:[(0,i.jsxs)(d.A,{variant:"h6",sx:{mb:2},children:["検索結果: ",W.length,"件"]}),W.map((l,s)=>(0,i.jsxs)(p.A,{sx:{p:2,mb:2},children:[(0,i.jsxs)(d.A,{variant:"subtitle1",sx:{mb:1},children:["盃: ",(l=>{let s=e.find(e=>e.id===l);return(null==s?void 0:s.name)||"不明"})(l.grail.nightRunnerId)," - ",l.grail.colors.map(e=>e).join("・")]}),(0,i.jsx)(v.A,{children:(0,i.jsxs)(S.A,{size:"small",children:[(0,i.jsx)(C.A,{children:(0,i.jsxs)(y.A,{children:[(0,i.jsx)(b.A,{children:"色"}),(0,i.jsx)(b.A,{children:"効果1"}),(0,i.jsx)(b.A,{children:"効果2"}),(0,i.jsx)(b.A,{children:"効果3"})]})}),(0,i.jsx)(w.A,{children:l.relics.map(e=>(0,i.jsxs)(y.A,{children:[(0,i.jsx)(b.A,{children:(0,i.jsx)(q.A,{label:e.color,color:{赤:"error",青:"primary",黄:"warning",緑:"success",無色:"default"}[e.color],size:"small"})}),(0,i.jsx)(b.A,{children:U(e.effects[0])}),(0,i.jsx)(b.A,{children:U(e.effects[1])}),(0,i.jsx)(b.A,{children:U(e.effects[2])})]},e.id))})]})})]},s))]}),0===W.length&&E&&G.length>0&&(0,i.jsx)(p.A,{sx:{p:3},children:(0,i.jsx)(d.A,{color:"text.secondary",children:"条件に一致する組み合わせが見つかりませんでした。"})})]})}function eu(){let[e,l]=(0,n.useState)(0);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.A,{position:"static",children:(0,i.jsx)(a.A,{children:(0,i.jsx)(d.A,{variant:"h6",component:"div",children:"遺物管理システム"})})}),(0,i.jsxs)(r.A,{maxWidth:"lg",sx:{mt:4},children:[(0,i.jsx)(c.A,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,i.jsxs)(o.A,{value:e,onChange:(e,s)=>l(s),children:[(0,i.jsx)(x.A,{label:"複合検索"}),(0,i.jsx)(x.A,{label:"遺物"}),(0,i.jsx)(x.A,{label:"効果"}),(0,i.jsx)(x.A,{label:"カテゴリ"}),(0,i.jsx)(x.A,{label:"夜渡り"}),(0,i.jsx)(x.A,{label:"盃"})]})}),0===e&&(0,i.jsx)(ej,{}),1===e&&(0,i.jsx)(Y,{}),2===e&&(0,i.jsx)(Z,{}),3===e&&(0,i.jsx)(ee,{}),4===e&&(0,i.jsx)(es,{}),5===e&&(0,i.jsx)(et,{})]})]})}},4135:(e,l,s)=>{Promise.resolve().then(s.bind(s,2887))}},e=>{e.O(0,[135,865,687,441,255,358],()=>e(e.s=4135)),_N_E=e.O()}]);